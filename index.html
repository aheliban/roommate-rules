<!DOCTYPE html>
<html lang="en">
<head>
Â Â <meta charset="UTF-8" />
Â Â <title>Camel and Rain Tea â€“ Apartment Rules Voting</title>
Â Â <meta name="viewport" content="width=device-width, initial-scale=1" />
Â Â <style>
Â Â Â Â :root {
Â Â Â Â Â Â --bg: #020617;
Â Â Â Â Â Â --bg-soft: #020617;
Â Â Â Â Â Â --card: #020617;
Â Â Â Â Â Â --card-soft: #020617;
Â Â Â Â Â Â --accent: #38bdf8;
Â Â Â Â Â Â --accent-soft: rgba(56, 189, 248, 0.1);
Â Â Â Â Â Â --accent-strong: #0ea5e9;
Â Â Â Â Â Â --danger: #f97373;
Â Â Â Â Â Â --success: #4ade80;
Â Â Â Â Â Â --border-subtle: #1f2937;
Â Â Â Â Â Â --text-main: #e5e7eb;
Â Â Â Â Â Â --text-muted: #9ca3af;
Â Â Â Â Â Â --text-soft: #6b7280;
Â Â Â Â Â Â --chip-bg: #111827;
Â Â Â Â }

Â Â Â Â * {
Â Â Â Â Â Â box-sizing: border-box;
Â Â Â Â }

Â Â Â Â body {
Â Â Â Â Â Â margin: 0;
Â Â Â Â Â Â min-height: 100vh;
Â Â Â Â Â Â font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
Â Â Â Â Â Â Â Â sans-serif;
Â Â Â Â Â Â background:
Â Â Â Â Â Â Â Â radial-gradient(circle at top left, #38bdf8 0, transparent 55%),
Â Â Â Â Â Â Â Â radial-gradient(circle at bottom right, #22c55e 0, transparent 55%),
Â Â Â Â Â Â Â Â #020617;
Â Â Â Â Â Â color: var(--text-main);
Â Â Â Â Â Â -webkit-font-smoothing: antialiased;
Â Â Â Â }

Â Â Â Â .app {
Â Â Â Â Â Â max-width: 960px;
Â Â Â Â Â Â margin: 0 auto;
Â Â Â Â Â Â padding: 1.5rem 1.25rem 3rem;
Â Â Â Â }

Â Â Â Â .hero {
Â Â Â Â Â Â background: rgba(15, 23, 42, 0.9);
Â Â Â Â Â Â border-radius: 18px;
Â Â Â Â Â Â padding: 1.5rem 1.5rem 1.25rem;
Â Â Â Â Â Â border: 1px solid rgba(148, 163, 184, 0.35);
Â Â Â Â Â Â box-shadow: 0 18px 40px rgba(15, 23, 42, 0.7);
Â Â Â Â Â Â backdrop-filter: blur(18px);
Â Â Â Â Â Â margin-bottom: 1.75rem;
Â Â Â Â Â Â position: relative;
Â Â Â Â Â Â overflow: hidden;
Â Â Â Â }

Â Â Â Â .hero::before {
Â Â Â Â Â Â content: "ğŸ«";
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â right: 1.5rem;
Â Â Â Â Â Â top: 0.9rem;
Â Â Â Â Â Â font-size: 1.7rem;
Â Â Â Â Â Â opacity: 0.9;
Â Â Â Â }

Â Â Â Â .hero::after {
Â Â Â Â Â Â content: "â˜”ï¸ğŸµ";
Â Â Â Â Â Â position: absolute;
Â Â Â Â Â Â right: 1.25rem;
Â Â Â Â Â Â bottom: 0.9rem;
Â Â Â Â Â Â font-size: 1.1rem;
Â Â Â Â Â Â opacity: 0.7;
Â Â Â Â }

Â Â Â Â .hero-title {
Â Â Â Â Â Â font-size: clamp(1.5rem, 3vw, 1.9rem);
Â Â Â Â Â Â font-weight: 700;
Â Â Â Â Â Â letter-spacing: 0.03em;
Â Â Â Â Â Â margin: 0 0 0.25rem;
Â Â Â Â }

Â Â Â Â .hero-subtitle {
Â Â Â Â Â Â margin: 0;
Â Â Â Â Â Â font-size: 0.9rem;
Â Â Â Â Â Â color: var(--text-muted);
Â Â Â Â }

Â Â Â Â .hero-tagline {
Â Â Â Â Â Â margin-top: 0.8rem;
Â Â Â Â Â Â font-size: 0.85rem;
Â Â Â Â Â Â color: var(--text-soft);
Â Â Â Â }

Â Â Â Â .badge-row {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â Â Â gap: 0.5rem;
Â Â Â Â Â Â margin-top: 1rem;
Â Â Â Â }

Â Â Â Â .badge {
Â Â Â Â Â Â font-size: 0.74rem;
Â Â Â Â Â Â text-transform: uppercase;
Â Â Â Â Â Â letter-spacing: 0.09em;
Â Â Â Â Â Â padding: 0.25rem 0.6rem;
Â Â Â Â Â Â border-radius: 9999px;
Â Â Â Â Â Â border: 1px solid rgba(148, 163, 184, 0.4);
Â Â Â Â Â Â background: rgba(15, 23, 42, 0.7);
Â Â Â Â Â Â display: inline-flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 0.3rem;
Â Â Â Â Â Â color: var(--text-muted);
Â Â Â Â Â Â white-space: nowrap;
Â Â Â Â }

Â Â Â Â .badge-dot {
Â Â Â Â Â Â width: 6px;
Â Â Â Â Â Â height: 6px;
Â Â Â Â Â Â border-radius: 999px;
Â Â Â Â Â Â background: var(--accent);
Â Â Â Â }

Â Â Â Â .badge-unanimous {
Â Â Â Â Â Â border-color: rgba(74, 222, 128, 0.6);
Â Â Â Â }

Â Â Â Â .badge-anon {
Â Â Â Â Â Â border-color: rgba(129, 140, 248, 0.6);
Â Â Â Â }

Â Â Â Â .grid {
Â Â Â Â Â Â display: grid;
Â Â Â Â Â Â grid-template-columns: minmax(0, 1.15fr) minmax(0, 1.85fr);
Â Â Â Â Â Â gap: 1.25rem;
Â Â Â Â }

Â Â Â Â @media (max-width: 800px) {
Â Â Â Â Â Â .grid {
Â Â Â Â Â Â Â Â grid-template-columns: minmax(0, 1fr);
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â section {
Â Â Â Â Â Â background: rgba(15, 23, 42, 0.96);
Â Â Â Â Â Â border-radius: 16px;
Â Â Â Â Â Â padding: 1.15rem 1.15rem 1.25rem;
Â Â Â Â Â Â border: 1px solid var(--border-subtle);
Â Â Â Â Â Â box-shadow: 0 14px 35px rgba(15, 23, 42, 0.7);
Â Â Â Â }

Â Â Â Â section + section {
Â Â Â Â Â Â margin-top: 0;
Â Â Â Â }

Â Â Â Â h2 {
Â Â Â Â Â Â font-size: 1rem;
Â Â Â Â Â Â margin: 0 0 0.5rem;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 0.4rem;
Â Â Â Â }

Â Â Â Â h2 span.eyebrow {
Â Â Â Â Â Â font-size: 0.85rem;
Â Â Â Â Â Â color: var(--accent-strong);
Â Â Â Â Â Â text-transform: uppercase;
Â Â Â Â Â Â letter-spacing: 0.12em;
Â Â Â Â Â Â font-weight: 600;
Â Â Â Â }

Â Â Â Â .section-desc {
Â Â Â Â Â Â font-size: 0.82rem;
Â Â Â Â Â Â color: var(--text-soft);
Â Â Â Â Â Â margin-bottom: 0.75rem;
Â Â Â Â }

Â Â Â Â label {
Â Â Â Â Â Â display: block;
Â Â Â Â Â Â margin-bottom: 0.3rem;
Â Â Â Â Â Â font-size: 0.82rem;
Â Â Â Â Â Â font-weight: 500;
Â Â Â Â Â Â color: var(--text-muted);
Â Â Â Â }

Â Â Â Â input[type="text"],
Â Â Â Â textarea {
Â Â Â Â Â Â width: 100%;
Â Â Â Â Â Â padding: 0.55rem 0.65rem;
Â Â Â Â Â Â margin-bottom: 0.6rem;
Â Â Â Â Â Â border-radius: 10px;
Â Â Â Â Â Â border: 1px solid #1f2937;
Â Â Â Â Â Â background: #020617;
Â Â Â Â Â Â color: var(--text-main);
Â Â Â Â Â Â font-size: 0.9rem;
Â Â Â Â Â Â outline: none;
Â Â Â Â Â Â transition: border-color 0.15s ease, box-shadow 0.15s ease,
Â Â Â Â Â Â Â Â background 0.15s ease;
Â Â Â Â }

Â Â Â Â input[type="text"]::placeholder,
Â Â Â Â textarea::placeholder {
Â Â Â Â Â Â color: #4b5563;
Â Â Â Â }

Â Â Â Â input[type="text"]:focus,
Â Â Â Â textarea:focus {
Â Â Â Â Â Â border-color: var(--accent);
Â Â Â Â Â Â box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45);
Â Â Â Â Â Â background: #020617;
Â Â Â Â }

Â Â Â Â textarea {
Â Â Â Â Â Â min-height: 70px;
Â Â Â Â Â Â resize: vertical;
Â Â Â Â }

Â Â Â Â .btn-row {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â Â Â gap: 0.5rem;
Â Â Â Â Â Â align-items: center;
Â Â Â Â }

Â Â Â Â button {
Â Â Â Â Â Â cursor: pointer;
Â Â Â Â Â Â border: none;
Â Â Â Â Â Â border-radius: 999px;
Â Â Â Â Â Â padding: 0.45rem 0.9rem;
Â Â Â Â Â Â font-size: 0.85rem;
Â Â Â Â Â Â font-weight: 500;
Â Â Â Â Â Â display: inline-flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 0.4rem;
Â Â Â Â Â Â transition: transform 0.06s ease, box-shadow 0.06s ease,
Â Â Â Â Â Â Â Â background 0.15s ease, color 0.15s ease;
Â Â Â Â Â Â white-space: nowrap;
Â Â Â Â }

Â Â Â Â button.primary {
Â Â Â Â Â Â background: linear-gradient(135deg, #38bdf8, #0ea5e9);
Â Â Â Â Â Â color: #0b1120;
Â Â Â Â Â Â box-shadow: 0 8px 20px rgba(56, 189, 248, 0.5);
Â Â Â Â }

Â Â Â Â button.primary:hover:not(:disabled) {
Â Â Â Â Â Â transform: translateY(-1px);
Â Â Â Â Â Â box-shadow: 0 12px 28px rgba(56, 189, 248, 0.6);
Â Â Â Â }

Â Â Â Â button.secondary {
Â Â Â Â Â Â background: rgba(15, 23, 42, 0.95);
Â Â Â Â Â Â color: var(--text-main);
Â Â Â Â Â Â border: 1px solid #1f2937;
Â Â Â Â }

Â Â Â Â button.secondary:hover:not(:disabled) {
Â Â Â Â Â Â background: #020617;
Â Â Â Â Â Â border-color: #374151;
Â Â Â Â }

Â Â Â Â button:disabled {
Â Â Â Â Â Â opacity: 0.55;
Â Â Â Â Â Â cursor: default;
Â Â Â Â Â Â transform: none;
Â Â Â Â Â Â box-shadow: none;
Â Â Â Â }

Â Â Â Â .small {
Â Â Â Â Â Â font-size: 0.8rem;
Â Â Â Â Â Â color: var(--text-soft);
Â Â Â Â Â Â margin-top: 0.25rem;
Â Â Â Â }

Â Â Â Â .danger {
Â Â Â Â Â Â color: var(--danger);
Â Â Â Â }

Â Â Â Â .success {
Â Â Â Â Â Â color: var(--success);
Â Â Â Â }

Â Â Â Â #rules-section {
Â Â Â Â Â Â max-height: 560px;
Â Â Â Â Â Â overflow: hidden;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-direction: column;
Â Â Â Â }

Â Â Â Â #rules-list {
Â Â Â Â Â Â margin-top: 0.3rem;
Â Â Â Â Â Â padding-top: 0.4rem;
Â Â Â Â Â Â border-top: 1px solid #1f2937;
Â Â Â Â Â Â overflow-y: auto;
Â Â Â Â Â Â scrollbar-width: thin;
Â Â Â Â Â Â scrollbar-color: #4b5563 #020617;
Â Â Â Â }

Â Â Â Â #rules-list::-webkit-scrollbar {
Â Â Â Â Â Â width: 6px;
Â Â Â Â }

Â Â Â Â #rules-list::-webkit-scrollbar-track {
Â Â Â Â Â Â background: #020617;
Â Â Â Â }

Â Â Â Â #rules-list::-webkit-scrollbar-thumb {
Â Â Â Â Â Â background: #4b5563;
Â Â Â Â Â Â border-radius: 999px;
Â Â Â Â }

Â Â Â Â .rule {
Â Â Â Â Â Â padding: 0.7rem 0.25rem;
Â Â Â Â Â Â border-bottom: 1px solid #111827;
Â Â Â Â }

Â Â Â Â .rule:last-child {
Â Â Â Â Â Â border-bottom: none;
Â Â Â Â }

Â Â Â Â .rule-header {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â justify-content: space-between;
Â Â Â Â Â Â align-items: flex-start;
Â Â Â Â Â Â gap: 0.5rem;
Â Â Â Â Â Â margin-bottom: 0.15rem;
Â Â Â Â }

Â Â Â Â .rule-text {
Â Â Â Â Â Â font-weight: 600;
Â Â Â Â Â Â font-size: 0.9rem;
Â Â Â Â }

Â Â Â Â .rule-chip {
Â Â Â Â Â Â background: var(--chip-bg);
Â Â Â Â Â Â border-radius: 999px;
Â Â Â Â Â Â padding: 0.15rem 0.55rem;
Â Â Â Â Â Â font-size: 0.7rem;
Â Â Â Â Â Â color: var(--text-muted);
Â Â Â Â Â Â border: 1px solid #1f2937;
Â Â Â Â Â Â white-space: nowrap;
Â Â Â Â }

Â Â Â Â .meta-row {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â flex-wrap: wrap;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 0.4rem;
Â Â Â Â Â Â margin: 0.1rem 0 0.35rem;
Â Â Â Â Â Â font-size: 0.7rem;
Â Â Â Â Â Â color: var(--text-soft);
Â Â Â Â }

Â Â Â Â .status {
Â Â Â Â Â Â font-size: 0.82rem;
Â Â Â Â Â Â margin: 0.2rem 0;
Â Â Â Â }

Â Â Â Â .status.pass {
Â Â Â Â Â Â color: var(--success);
Â Â Â Â Â Â font-weight: 600;
Â Â Â Â }

Â Â Â Â .status.fail {
Â Â Â Â Â Â color: var(--danger);
Â Â Â Â Â Â font-weight: 600;
Â Â Â Â }

Â Â Â Â .vote-buttons {
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 0.45rem;
Â Â Â Â Â Â margin-top: 0.25rem;
Â Â Â Â Â Â margin-bottom: 0.15rem;
Â Â Â Â }

Â Â Â Â .pill {
Â Â Â Â Â Â display: inline-flex;
Â Â Â Â Â Â align-items: center;
Â Â Â Â Â Â gap: 0.35rem;
Â Â Â Â Â Â font-size: 0.78rem;
Â Â Â Â Â Â color: var(--text-soft);
Â Â Â Â }

Â Â Â Â .pill-dot {
Â Â Â Â Â Â width: 7px;
Â Â Â Â Â Â height: 7px;
Â Â Â Â Â Â border-radius: 999px;
Â Â Â Â }

Â Â Â Â .pill-dot.waiting {
Â Â Â Â Â Â background: var(--accent);
Â Â Â Â }

Â Â Â Â .pill-dot.done {
Â Â Â Â Â Â background: var(--success);
Â Â Â Â }

Â Â Â Â footer {
Â Â Â Â Â Â margin-top: 1.75rem;
Â Â Â Â Â Â text-align: center;
Â Â Â Â Â Â font-size: 0.72rem;
Â Â Â Â Â Â color: var(--text-soft);
Â Â Â Â Â Â opacity: 0.75;
Â Â Â Â }
Â Â </style>
</head>
<body>
Â Â <div class="app">
Â Â Â Â <header class="hero">
Â Â Â Â Â Â <p class="hero-subtitle">wifi: camelandraintea</p>
Â Â Â Â Â Â <h1 class="hero-title">Camel and Rain Tea</h1>
Â Â Â Â Â Â <p class="hero-subtitle">Apartment Rules Voting</p>
Â Â Â Â Â Â <p class="hero-tagline">
Â Â Â Â Â Â Â Â Anonymous proposals. Anonymous votes. A rule only passes if all four of you say yes.
Â Â Â Â Â Â </p>
Â Â Â Â Â Â <div class="badge-row">
Â Â Â Â Â Â Â Â <div class="badge badge-unanimous">
Â Â Â Â Â Â Â Â Â Â <span class="badge-dot"></span>
Â Â Â Â Â Â Â Â Â Â <span>Unanimous only</span>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â <div class="badge badge-anon">
Â Â Â Â Â Â Â Â Â Â <span class="badge-dot"></span>
Â Â Â Â Â Â Â Â Â Â <span>Anonymous &amp; low-drama</span>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â <div class="badge">
Â Â Â Â Â Â Â Â Â Â <span class="badge-dot"></span>
Â Â Â Â Â Â Â Â Â Â <span>Results only after 4 votes</span>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â </div>
Â Â Â Â </header>

Â Â Â Â <main class="grid">
Â Â Â Â Â Â <section id="voter-section">
Â Â Â Â Â Â Â Â <h2>
Â Â Â Â Â Â Â Â Â Â <span class="eyebrow">Step 1</span> Set your secret voter code
Â Â Â Â Â Â Â Â </h2>
Â Â Â Â Â Â Â Â <p class="section-desc">
Â Â Â Â Â Â Â Â Â Â Each roommate picks a private code (only you know yours). This stays on your device and
Â Â Â Â Â Â Â Â Â Â is stored as a hash. No names, no emails, no linking votes to people.
Â Â Â Â Â Â Â Â </p>
Â Â Â Â Â Â Â Â <label for="voterCodeInput">Secret voter code</label>
Â Â Â Â Â Â Â Â <input
Â Â Â Â Â Â Â Â Â Â type="text"
Â Â Â Â Â Â Â Â Â Â id="voterCodeInput"
Â Â Â Â Â Â Â Â Â Â placeholder="something only you will remember"
Â Â Â Â Â Â Â Â />
Â Â Â Â Â Â Â Â <div class="btn-row">
Â Â Â Â Â Â Â Â Â Â <button class="primary" id="setCodeBtn">
Â Â Â Â Â Â Â Â Â Â Â Â <span>Set code</span>
Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â <p id="voterStatus" class="small"></p>

Â Â Â Â Â Â Â Â <hr style="border: 0; border-top: 1px solid #1f2937; margin: 1rem 0 0.75rem;" />

Â Â Â Â Â Â Â Â <h2>
Â Â Â Â Â Â Â Â Â Â <span class="eyebrow">Step 2</span> Add a rule
Â Â Â Â Â Â Â Â </h2>
Â Â Â Â Â Â Â Â <p class="section-desc">
Â Â Â Â Â Â Â Â Â Â Anyone can propose a rule. Keep it general (no names, no targeting specific people).
Â Â Â Â Â Â Â Â </p>
Â Â Â Â Â Â Â Â <label for="ruleText">Rule text</label>
Â Â Â Â Â Â Â Â <textarea id="ruleText" placeholder="No loud music after 11pm."></textarea>
Â Â Â Â Â Â Â Â <div class="btn-row">
Â Â Â Â Â Â Â Â Â Â <button class="primary" id="proposeBtn">
Â Â Â Â Â Â Â Â Â Â Â Â <span>Submit rule</span>
Â Â Â Â Â Â Â Â Â Â </button>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â <p id="proposeStatus" class="small"></p>
Â Â Â Â Â Â </section>

Â Â Â Â Â Â <section id="rules-section">
Â Â Â Â Â Â Â Â <h2>
Â Â Â Â Â Â Â Â Â Â <span class="eyebrow">Step 3</span> Vote on open rules
Â Â Â Â Â Â Â Â </h2>
Â Â Â Â Â Â Â Â <p class="section-desc">
Â Â Â Â Â Â Â Â Â Â Once a week, everyone opens this page, sets their code, and votes
Â Â Â Â Â Â Â Â Â Â <strong>YES</strong> or <strong>NO</strong> on each rule. When all four
Â Â Â Â Â Â Â Â Â Â votes are in, the final tally appears. Unanimous yes = the rule is adopted.
Â Â Â Â Â Â Â Â </p>

Â Â Â Â Â Â Â Â <div id="rules-list">
Â Â Â Â Â Â Â Â Â Â <p class="small">Loading rulesâ€¦</p>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â </section>
Â Â Â Â </main>

Â Â Â Â <footer>
Â Â Â Â Â Â Camel and Rain Tea &middot; Anonymous roommate constitution engine
Â Â Â Â </footer>
Â Â </div>

Â Â <!-- Firebase + app logic -->
Â Â <script type="module">
Â Â Â Â import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
Â Â Â Â import {
Â Â Â Â Â Â getFirestore,
Â Â Â Â Â Â collection,
Â Â Â Â Â Â addDoc,
Â Â Â Â Â Â doc,
Â Â Â Â Â Â setDoc,
Â Â Â Â Â Â getDocs,
Â Â Â Â Â Â serverTimestamp,
Â Â Â Â Â Â query,
Â Â Â Â Â Â orderBy
Â Â Â Â } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

Â Â Â Â // TODO: paste your actual Firebase config here (the one you already used)
Â Â Â Â const firebaseConfig = {
Â Â Â Â Â Â apiKey: "YOUR_API_KEY_HERE",
Â Â Â Â Â Â authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
Â Â Â Â Â Â projectId: "YOUR_PROJECT_ID",
Â Â Â Â Â Â storageBucket: "YOUR_PROJECT_ID.appspot.com",
Â Â Â Â Â Â messagingSenderId: "YOUR_SENDER_ID",
Â Â Â Â Â Â appId: "YOUR_APP_ID"
Â Â Â Â };

Â Â Â Â // 4 roommates, 4 votes required before results show
Â Â Â Â const TOTAL_VOTERS = 4;

Â Â Â Â const app = initializeApp(firebaseConfig);
Â Â Â Â const db = getFirestore(app);

Â Â Â Â const voterInput = document.getElementById("voterCodeInput");
Â Â Â Â const setCodeBtn = document.getElementById("setCodeBtn");
Â Â Â Â const voterStatus = document.getElementById("voterStatus");

Â Â Â Â const ruleTextInput = document.getElementById("ruleText");
Â Â Â Â const proposeBtn = document.getElementById("proposeBtn");
Â Â Â Â const proposeStatus = document.getElementById("proposeStatus");

Â Â Â Â const rulesList = document.getElementById("rules-list");

Â Â Â Â let currentVoterHash = null;

Â Â Â Â // --- hashing helper ---
Â Â Â Â async function hashCodeToHex(code) {
Â Â Â Â Â Â const enc = new TextEncoder();
Â Â Â Â Â Â const data = enc.encode(code);
Â Â Â Â Â Â const hashBuffer = await crypto.subtle.digest("SHA-256", data);
Â Â Â Â Â Â const hashArray = Array.from(new Uint8Array(hashBuffer));
Â Â Â Â Â Â return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
Â Â Â Â }

Â Â Â Â function shortHash(hash) {
Â Â Â Â Â Â return hash ? hash.substring(0, 8) + "â€¦" : "";
Â Â Â Â }

Â Â Â Â // restore voter hash from localStorage if present
Â Â Â Â async function initVoterFromStorage() {
Â Â Â Â Â Â const stored = localStorage.getItem("voterHash");
Â Â Â Â Â Â if (stored) {
Â Â Â Â Â Â Â Â currentVoterHash = stored;
Â Â Â Â Â Â Â Â voterStatus.textContent =
Â Â Â Â Â Â Â Â Â Â "Voter code set (hash " + shortHash(stored) + ").";
Â Â Â Â Â Â Â Â voterStatus.classList.remove("danger");
Â Â Â Â Â Â Â Â voterStatus.classList.add("success");
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â setCodeBtn.addEventListener("click", async () => {
Â Â Â Â Â Â const code = voterInput.value.trim();
Â Â Â Â Â Â if (!code) {
Â Â Â Â Â Â Â Â voterStatus.textContent = "Enter a non-empty code.";
Â Â Â Â Â Â Â Â voterStatus.classList.add("danger");
Â Â Â Â Â Â Â Â voterStatus.classList.remove("success");
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }

Â Â Â Â Â Â const hash = await hashCodeToHex(code);
Â Â Â Â Â Â currentVoterHash = hash;
Â Â Â Â Â Â localStorage.setItem("voterHash", hash);

Â Â Â Â Â Â voterStatus.textContent =
Â Â Â Â Â Â Â Â "Voter code set (hash " + shortHash(hash) + "). Keep this code secret.";
Â Â Â Â Â Â voterStatus.classList.remove("danger");
Â Â Â Â Â Â voterStatus.classList.add("success");
Â Â Â Â Â Â voterInput.value = "";

Â Â Â Â Â Â loadRules();
Â Â Â Â });

Â Â Â Â // --- propose rule ---
Â Â Â Â proposeBtn.addEventListener("click", async () => {
Â Â Â Â Â Â const text = ruleTextInput.value.trim();
Â Â Â Â Â Â if (!text) {
Â Â Â Â Â Â Â Â proposeStatus.textContent = "Rule text canâ€™t be empty.";
Â Â Â Â Â Â Â Â proposeStatus.classList.add("danger");
Â Â Â Â Â Â Â Â proposeStatus.classList.remove("success");
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }

Â Â Â Â Â Â proposeBtn.disabled = true;
Â Â Â Â Â Â proposeStatus.textContent = "Submittingâ€¦";
Â Â Â Â Â Â proposeStatus.classList.remove("danger", "success");

Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â await addDoc(collection(db, "rules"), {
Â Â Â Â Â Â Â Â Â Â text,
Â Â Â Â Â Â Â Â Â Â createdAt: serverTimestamp()
Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â proposeStatus.textContent = "Rule submitted.";
Â Â Â Â Â Â Â Â proposeStatus.classList.add("success");
Â Â Â Â Â Â Â Â ruleTextInput.value = "";
Â Â Â Â Â Â Â Â loadRules();
Â Â Â Â Â Â } catch (err) {
Â Â Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â Â Â proposeStatus.textContent = "Error submitting rule.";
Â Â Â Â Â Â Â Â proposeStatus.classList.add("danger");
Â Â Â Â Â Â } finally {
Â Â Â Â Â Â Â Â proposeBtn.disabled = false;
Â Â Â Â Â Â }
Â Â Â Â });

Â Â Â Â // --- load and render rules ---
Â Â Â Â async function loadRules() {
Â Â Â Â Â Â rulesList.innerHTML = "<p class='small'>Loadingâ€¦</p>";
Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â const rulesRef = collection(db, "rules");
Â Â Â Â Â Â Â Â const qRules = query(rulesRef, orderBy("createdAt", "desc"));
Â Â Â Â Â Â Â Â const snap = await getDocs(qRules);

Â Â Â Â Â Â Â Â if (snap.empty) {
Â Â Â Â Â Â Â Â Â Â rulesList.innerHTML =
Â Â Â Â Â Â Â Â Â Â Â Â "<p class='small'>No rules yet. Someone be brave and add the first one.</p>";
Â Â Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â rulesList.innerHTML = "";
Â Â Â Â Â Â Â Â for (const ruleDoc of snap.docs) {
Â Â Â Â Â Â Â Â Â Â await renderRule(ruleDoc);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â } catch (err) {
Â Â Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â Â Â rulesList.innerHTML =
Â Â Â Â Â Â Â Â Â Â "<p class='small danger'>Error loading rules. Check Firebase config / rules.</p>";
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â function formatDate(ts) {
Â Â Â Â Â Â if (!ts || !ts.toDate) return "";
Â Â Â Â Â Â const d = ts.toDate();
Â Â Â Â Â Â return d.toLocaleString(undefined, {
Â Â Â Â Â Â Â Â month: "short",
Â Â Â Â Â Â Â Â day: "numeric",
Â Â Â Â Â Â Â Â hour: "2-digit",
Â Â Â Â Â Â Â Â minute: "2-digit"
Â Â Â Â Â Â });
Â Â Â Â }

Â Â Â Â async function renderRule(ruleDoc) {
Â Â Â Â Â Â const data = ruleDoc.data();
Â Â Â Â Â Â const ruleId = ruleDoc.id;

Â Â Â Â Â Â const votesRef = collection(db, "rules", ruleId, "votes");
Â Â Â Â Â Â const votesSnap = await getDocs(votesRef);
Â Â Â Â Â Â const votes = votesSnap.docs.map((d) => d.data());

Â Â Â Â Â Â const uniqueVoters = new Set(votes.map((v) => v.voterHash));
Â Â Â Â Â Â const voteCount = uniqueVoters.size;
Â Â Â Â Â Â const totalVoters = TOTAL_VOTERS;

Â Â Â Â Â Â let yes = 0;
Â Â Â Â Â Â let no = 0;
Â Â Â Â Â Â votes.forEach((v) => {
Â Â Â Â Â Â Â Â if (v.vote === "YES") yes++;
Â Â Â Â Â Â Â Â else if (v.vote === "NO") no++;
Â Â Â Â Â Â });

Â Â Â Â Â Â const wrapper = document.createElement("div");
Â Â Â Â Â Â wrapper.className = "rule";

Â Â Â Â Â Â const header = document.createElement("div");
Â Â Â Â Â Â header.className = "rule-header";

Â Â Â Â Â Â const textEl = document.createElement("div");
Â Â Â Â Â Â textEl.className = "rule-text";
Â Â Â Â Â Â textEl.textContent = data.text || "(no text)";
Â Â Â Â Â Â header.appendChild(textEl);

Â Â Â Â Â Â const chip = document.createElement("div");
Â Â Â Â Â Â chip.className = "rule-chip";
Â Â Â Â Â Â chip.textContent = "Rule ID: " + ruleId.slice(0, 8) + "â€¦";
Â Â Â Â Â Â header.appendChild(chip);

Â Â Â Â Â Â wrapper.appendChild(header);

Â Â Â Â Â Â const metaRow = document.createElement("div");
Â Â Â Â Â Â metaRow.className = "meta-row";
Â Â Â Â Â Â const created = formatDate(data.createdAt);
Â Â Â Â Â Â if (created) {
Â Â Â Â Â Â Â Â const createdEl = document.createElement("span");
Â Â Â Â Â Â Â Â createdEl.textContent = "Added " + created;
Â Â Â Â Â Â Â Â metaRow.appendChild(createdEl);
Â Â Â Â Â Â }

Â Â Â Â Â Â const votesInfo = document.createElement("span");
Â Â Â Â Â Â votesInfo.textContent = voteCount + " / " + totalVoters + " votes in";
Â Â Â Â Â Â metaRow.appendChild(votesInfo);
Â Â Â Â Â Â wrapper.appendChild(metaRow);

Â Â Â Â Â Â const statusEl = document.createElement("div");
Â Â Â Â Â Â statusEl.className = "status";
Â Â Â Â Â Â wrapper.appendChild(statusEl);

Â Â Â Â Â Â const voteButtons = document.createElement("div");
Â Â Â Â Â Â voteButtons.className = "vote-buttons";

Â Â Â Â Â Â const yesBtn = document.createElement("button");
Â Â Â Â Â Â yesBtn.textContent = "YES";
Â Â Â Â Â Â yesBtn.className = "primary";

Â Â Â Â Â Â const noBtn = document.createElement("button");
Â Â Â Â Â Â noBtn.textContent = "NO";
Â Â Â Â Â Â noBtn.className = "secondary";

Â Â Â Â Â Â voteButtons.appendChild(yesBtn);
Â Â Â Â Â Â voteButtons.appendChild(noBtn);
Â Â Â Â Â Â wrapper.appendChild(voteButtons);

Â Â Â Â Â Â const infoEl = document.createElement("div");
Â Â Â Â Â Â infoEl.className = "small";
Â Â Â Â Â Â wrapper.appendChild(infoEl);

Â Â Â Â Â Â const hasVoted =
Â Â Â Â Â Â Â Â currentVoterHash && uniqueVoters.has(currentVoterHash);

Â Â Â Â Â Â if (voteCount < totalVoters) {
Â Â Â Â Â Â Â Â statusEl.textContent =
Â Â Â Â Â Â Â Â Â Â "Waiting for all four votes (" +
Â Â Â Â Â Â Â Â Â Â voteCount +
Â Â Â Â Â Â Â Â Â Â " / " +
Â Â Â Â Â Â Â Â Â Â totalVoters +
Â Â Â Â Â Â Â Â Â Â " in).";
Â Â Â Â Â Â Â Â statusEl.classList.remove("pass", "fail");

Â Â Â Â Â Â Â Â const pill = document.createElement("div");
Â Â Â Â Â Â Â Â pill.className = "pill";
Â Â Â Â Â Â Â Â pill.innerHTML =
Â Â Â Â Â Â Â Â Â Â '<span class="pill-dot waiting"></span><span>' +
Â Â Â Â Â Â Â Â Â Â (hasVoted
Â Â Â Â Â Â Â Â Â Â Â Â ? "Youâ€™ve voted. Final result will unlock when everyone else votes."
Â Â Â Â Â Â Â Â Â Â Â Â : "You havenâ€™t voted on this yet.") +
Â Â Â Â Â Â Â Â Â Â "</span>";
Â Â Â Â Â Â Â Â infoEl.appendChild(pill);
Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â statusEl.textContent =
Â Â Â Â Â Â Â Â Â Â "Final tally â€” YES: " + yes + ", NO: " + no + ".";
Â Â Â Â Â Â Â Â if (yes === totalVoters) {
Â Â Â Â Â Â Â Â Â Â statusEl.classList.add("pass");
Â Â Â Â Â Â Â Â Â Â statusEl.textContent += " Rule PASSES (unanimous).";
Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â statusEl.classList.add("fail");
Â Â Â Â Â Â Â Â Â Â statusEl.textContent += " Rule FAILS (not unanimous).";
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â const pill = document.createElement("div");
Â Â Â Â Â Â Â Â pill.className = "pill";
Â Â Â Â Â Â Â Â pill.innerHTML =
Â Â Â Â Â Â Â Â Â Â '<span class="pill-dot done"></span><span>Voting is complete. This rule is locked.</span>';
Â Â Â Â Â Â Â Â infoEl.appendChild(pill);
Â Â Â Â Â Â }

Â Â Â Â Â Â const disableVoting =
Â Â Â Â Â Â Â Â !currentVoterHash || hasVoted || voteCount >= totalVoters;

Â Â Â Â Â Â if (!currentVoterHash) {
Â Â Â Â Â Â Â Â infoEl.textContent =
Â Â Â Â Â Â Â Â Â Â "Set your secret voter code above before voting on anything.";
Â Â Â Â Â Â }

Â Â Â Â Â Â yesBtn.disabled = disableVoting;
Â Â Â Â Â Â noBtn.disabled = disableVoting;

Â Â Â Â Â Â yesBtn.addEventListener("click", () => handleVote(ruleId, "YES"));
Â Â Â Â Â Â noBtn.addEventListener("click", () => handleVote(ruleId, "NO"));

Â Â Â Â Â Â rulesList.appendChild(wrapper);
Â Â Â Â }

Â Â Â Â async function handleVote(ruleId, voteValue) {
Â Â Â Â Â Â if (!currentVoterHash) {
Â Â Â Â Â Â Â Â alert("Set your voter code first.");
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }

Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â const voteDocRef = doc(
Â Â Â Â Â Â Â Â Â Â db,
Â Â Â Â Â Â Â Â Â Â "rules",
Â Â Â Â Â Â Â Â Â Â ruleId,
Â Â Â Â Â Â Â Â Â Â "votes",
Â Â Â Â Â Â Â Â Â Â currentVoterHash
Â Â Â Â Â Â Â Â );

Â Â Â Â Â Â Â Â await setDoc(voteDocRef, {
Â Â Â Â Â Â Â Â Â Â voterHash: currentVoterHash,
Â Â Â Â Â Â Â Â Â Â vote: voteValue
Â Â Â Â Â Â Â Â });

Â Â Â Â Â Â Â Â loadRules();
Â Â Â Â Â Â } catch (err) {
Â Â Â Â Â Â Â Â console.error(err);
Â Â Â Â Â Â Â Â alert("Error submitting vote.");
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â (async () => {
Â Â Â Â Â Â await initVoterFromStorage();
Â Â Â Â Â Â await loadRules();
Â Â Â Â })();
Â Â </script>
</body>
</html>
